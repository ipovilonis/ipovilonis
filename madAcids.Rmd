---
title: "Acids"
output:
 html_document:
   toc: true
   toc_depth: 5
   toc_float:
     collapsed: false
     smooth_scroll: true
---

## Acidos orgánicos en peso fresco

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# #setwd("C:/Users/um/Documents/ipovilonis/Doc/6 - Producción/web/ipovilonis.github.io")
datap<-read.delim("CHac.txt")
datap$CAR <- factor(datap$CAR,
                   levels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "TartÃ¡rico","MÃ¡lico","QuÃ­nico",  "SuccÃ­nico", "glufru", "ATT"),
                   labels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "Tartárico","Málico","Quínico" ,"Succínico", "glufru", "ATT"))
datap$REP<-as.factor(datap$REP)
datap$CONF<-as.numeric(datap$CONF)
datap$MAD<-factor(datap$MAD,levels=c("I", "MM", "M", "SM"))

data3<-datap[-c(1:72,169:192),]

```

### Concentración del perfíl de ácidos orgánicos a distintos estados de Maturity
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=16, fig.height=14}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

datatar <- filter(data3, data3$CAR == "Tartárico")
datamal <- filter(data3, data3$CAR == "Málico")
dataqui <- filter(data3, data3$CAR == "Quínico")
datasuc <- filter(data3, data3$CAR == "Succínico")
dataatt <- filter(data3, data3$CAR == "ATT")
dataato <- dataAT

library(ggplot2)
aci1s<-ggplot2::ggplot(datatar, aes(x=MAD, y=CONF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Tartaric mg/g fresh fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci2s<-ggplot2::ggplot(datamal, aes(x=MAD, y=CONF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Malic mg/g fresh fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black', size=2))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci3s<-ggplot2::ggplot(dataqui, aes(x=MAD, y=CONF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Quinic mg/g fresh fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black', size=0.5))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci4s<-ggplot2::ggplot(datasuc, aes(x=MAD, y=CONF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Succinic mg/g fresh fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci5s<-ggplot2::ggplot(dataatt, aes(x=MAD, y=CONF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="TTA %", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())

aci6s<-ggplot2::ggplot(dataato, aes(x=MAD, y=TOTALF, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Total organic acids mg/g fresh fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

library(ggpubr)
ggarrange(aci1s, aci2s, aci3s, aci4s, aci5s, aci6s, common.legend = TRUE, legend = "bottom")
```

### Tabla descriptiva
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estadac <- summarySE(data3, measurevar="CONF", groupvars=c("CAR", "MAD"))
estadac

```

### Evolución del perfíl de ácidos orgánicos en la maduración
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data5<-data3
dataSI<-subset(data5, MAD == "I")
dataSMM<-subset(data5, MAD == "MM")
dataM<-subset(data5, MAD == "M")
dataSSM<-subset(data5, MAD == "SM")


SI<-ggplot(dataSI, aes(x = "CAR", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "INMADUROS")+
  theme(legend.title = element_blank())+
  xlab("[AO]") + ylab("mg/g fruta fresca")

SMM<-ggplot(dataSMM, aes(x = "CAR", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MEDIO MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[AO]") + ylab("mg/g fruta fresca")

SM<-ggplot(dataM, aes(x = "CAR", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[AO]") + ylab("mg/g fruta fresca")

SSM<-ggplot(dataSSM, aes(x = "CAR", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "SOBRE MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[AO]") + ylab("mg/g fruta fresca")

library(gridExtra)
grid.arrange(SI, SMM, SM, SSM, ncol = 2)

```

### Acidos orgánicos Totales

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

dataSACT<-read.delim("SACT.txt")
dataSACT$CAR <- as.factor(dataSACT$CAR)
dataSACT$REP<-as.factor(dataSACT$REP)
dataSACT$TOTALS<-as.numeric(dataSACT$TOTALS)
dataSACT$TOTALF<-as.numeric(dataSACT$TOTALF)
dataSACT$MAD<-factor(dataSACT$MAD,levels=c("I", "MM", "M", "SM"))

library(dplyr)

dataST<-filter(dataSACT, CAR == "SUGARS")
dataAT<-filter(dataSACT, CAR == "ACIDS")
dataCT<-filter(dataSACT, CAR == "CATIONS")
dataSTAT<-filter(dataSACT, CAR == "STAT")

```

#### Concentración de ácidos orgánicos totales a distintos estados de Maturity.
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gAT<-ggplot2::ggplot(dataAT, aes(x=MAD, y=TOTALF, fill=MAD)) +
  geom_boxplot(width = 0.50)+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="Totales (mg/g fruta fresca)", x="Maturity")+
  # facet_grid(CAR~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(legend.position = "none")
gAT

```

#### Tabla descriptiva totales
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estadSACT <- summarySE(dataSACT, measurevar="TOTALF", groupvars=c("CAR", "MAD"))
estadSACT

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mAT1 <- lme(TOTALF~ MAD, random = ~ 1|REP,
             control = ctrl, data = dataAT)

mAT1

AT_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mAT1),
  "predichos" = predict(mAT1)))

AT_ajuste$AT <- dataAT$TOTALF

library(ggplot2)
HVAT<-ggplot(AT_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVAT

QQAT<-ggplot(AT_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQAT

e<-resid(mAT1) # residuos de pearson
# pre<-predict(mAT1) #predichos
# alfai<-ranef(mAT1)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mAT1)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompAT<-emmeans(mAT1, pairwise ~ MAD) #Tukey  
CompAT
plot(CompAT, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity")

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity para los ácidos totales detectados en este trabajo.

### Ácido Tartárico


```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

tar<-subset(datap, CAR == "Tartárico")

# Se quitan outliers
# g_caja<-boxplot(tar$CONF, col="green3", frame.plot=T)
# tar<-tar[!(tar$CONF %in% g_caja$out),]
# g_caja<-boxplot(tar$CONF, col="green3", frame.plot=T)
# tar<-tar[!(tar$CONF %in% g_caja$out),]

```

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mtar2 <- lme(CONF~ MAD, random = ~ 1|REP,
             control = ctrl, data = tar)
mtar2

tar_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mtar2),
  "predichos" = predict(mtar2)))

tar_ajuste$CONF <- tar$CONF

library(ggplot2)
HVtar<-ggplot(tar_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVtar

QQtar<-ggplot(tar_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQtar

e<-resid(mtar2) # residuos de pearson
pre<-predict(mtar2) #predichos
alfai<-ranef(mtar2)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mtar2)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Comptar<-emmeans(mtar2, pairwise ~ MAD) #Tukey  
Comptar
plot(Comptar, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity" )

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity. El estado sobre maduro es el único que presenta ácido tartárico detectable.


### Ácido málico

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

mal<-subset(datap, CAR == "Málico")
# mal<-mal[-c(2),]
# Se quitan outliers
# g_caja<-boxplot(mal$CONF, col="green3", frame.plot=T)
# mal<-mal[!(mal$CONF %in% g_caja$out),]
# g_caja<-boxplot(mal$CONF, col="green3", frame.plot=T)
# mal<-mal[!(mal$CONF %in% g_caja$out),]

```

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mmal2 <- lme(CONF~ MAD, random = ~ 1|REP,
             weights=varIdent(form=~1|MAD),
             control = ctrl, data = mal)
mmal2

mal_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mmal2),
  "predichos" = predict(mmal2)))

mal_ajuste$CONF <- mal$CONF

library(ggplot2)
HVmal<-ggplot(mal_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVmal

QQmal<-ggplot(mal_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQmal

e<-resid(mmal2) # residuos de pearson
pre<-predict(mmal2) #predichos
alfai<-ranef(mmal2)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mmal2)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compmal<-emmeans(mmal2, pairwise ~ MAD) #Tukey  
Compmal
plot(Compmal, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity" )

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity. En el estado maduro se presentó el pico de concentración de ácido málico.

### Ácido quínico

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

qui<-subset(datap, CAR == "Quínico")
# qui2<-qui[5:24,]
# Se quitan outliers
# g_caja<-boxplot(qui2$CONF, col="green3", frame.plot=F)
# qui<-qui2[!(qui2$CONF %in% g_caja$out),]

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

ctrl <- lmeControl(opt='optim');
mqui2<- lme(CONF~MAD, random = ~ 1|REP,
                  control = ctrl, data = qui)
mqui2

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

qui_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mqui2),
  "predichos" = predict(mqui2)))

qui_ajuste$CONF <- qui$CONF

library(ggplot2)
HVqui<-ggplot(qui_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVqui

QQqui<-ggplot(qui_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQqui

e<-resid(mqui2) # residuos de pearson
pre<-predict(mqui2) #predichos
alfai<-ranef(mqui2)$REP$'(Intercept)'
shapiro.test(e)
library(car)
leveneTest(CONF~MAD, qui)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mqui2)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compqui<-emmeans(mqui2, pairwise ~ MAD) #Tukey  
Compqui
plot(Compqui, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity" )

```

#### Conclusiones

Se observa un marcado aumento de ácido quínico con la maduración hasta frutos maduros. Luego en frutos sobre maduros Frutos medio maduros presentan gran variabiliad.

### Ácido succinico

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

suc<-subset(datap, CAR == "Succínico")

ctrl <- lmeControl(opt='optim');
msuc2<-lme(CONF~MAD, random = ~ 1|REP,
           control = ctrl, data = suc)

suc_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(msuc2),
  "predichos" = predict(msuc2)))

suc_ajuste$CONF <- suc$CONF

library(ggplot2)
HVsuc<-ggplot(suc_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVsuc

QQsuc<-ggplot(suc_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQsuc

e<-resid(msuc2) # residuos de pearson
pre<-predict(msuc2) #predichos
alfai<-ranef(msuc2)$REP$'(Intercept)'
shapiro.test(e)
leveneTest(CONF~MAD, suc)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=7}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(msuc2)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compsuc<-emmeans(msuc2, pairwise ~ MAD) #Tukey  
Compsuc
plot(Compsuc, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity" )

```

#### Conclusiones

Se encontraron diferencias entre estados de Maturity, los frutos inmaduros y sobre maduros presentaron las mayores concentraciones de ácido succínico.

## Acidos orgánicos en peso seco

### Concentración del perfíl de ácidos orgánicos a distintos estados de Maturity
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=16, fig.height=14}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

datatar <- filter(data3, data3$CAR == "Tartárico")
datamal <- filter(data3, data3$CAR == "Málico")
dataqui <- filter(data3, data3$CAR == "Quínico")
datasuc <- filter(data3, data3$CAR == "Succínico")
dataatt <- filter(data3, data3$CAR == "ATT")
dataato <- dataAT

library(ggplot2)
aci1<-ggplot2::ggplot(datatar, aes(x=MAD, y=CONS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Tartaric mg/g dry fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci2<-ggplot2::ggplot(datamal, aes(x=MAD, y=CONS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Malic mg/g dry fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci3<-ggplot2::ggplot(dataqui, aes(x=MAD, y=CONS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Quinic mg/g dry fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci4<-ggplot2::ggplot(datasuc, aes(x=MAD, y=CONS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Succinic mg/g dry fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

aci5<-ggplot2::ggplot(dataatt, aes(x=MAD, y=CONS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="TTA %", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())

aci6<-ggplot2::ggplot(dataato, aes(x=MAD, y=TOTALS, color=MAD, width=1, shape=REP)) +
  geom_point(size=3)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2", "blue"))+
  labs(y="Total organic acids mg/g dry fruit", x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")

library(ggpubr)
ggarrange(aci1, aci2, aci3, aci4, aci5, aci6, common.legend = TRUE, legend = "bottom")

```

#### Tabla descriptiva
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estadacs <- summarySE(data3, measurevar="CONS", groupvars=c("CAR", "MAD"))
estadacs

```

#### Evolución del perfíl de ácidos orgánicos en la maduración
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data5<-data3
dataSI<-subset(data5, MAD == "I")
dataSMM<-subset(data5, MAD == "MM")
dataM<-subset(data5, MAD == "M")
dataSSM<-subset(data5, MAD == "SM")


SI<-ggplot(dataSI, aes(x = "CAT", y = CONS, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "INMADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SMM<-ggplot(dataSMM, aes(x = "CAT", y = CONS, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MEDIO MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SM<-ggplot(dataM, aes(x = "CAT", y = CONS, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SSM<-ggplot(dataSSM, aes(x = "CAT", y = CONS, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("red","coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "SOBRE MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

library(gridExtra)
grid.arrange(SI, SMM, SM, SSM, ncol = 2)

```

### Ácidos orgánicos totales
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gAT<-ggplot2::ggplot(dataSACT, aes(x=MAD, y=TOTALS, fill=MAD)) +
  geom_boxplot(width = 0.50)+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="Totales (mg/g fruto seca)", x="Maturity")+
  # facet_grid(CAR~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  scale_colour_manual(values = c("cyan4", "coral1","green3"))+
  theme(legend.position = "none")
gAT

```

#### Tabla descriptiva totales
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estadSACTS <- summarySE(dataSACT, measurevar="TOTALS", groupvars=c("CAR", "MAD"))
estadSACTS

```

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mAT1s <- lme(TOTALS~ MAD, random = ~ 1|REP,
             control = ctrl, data = dataAT)

mAT1s

ATs_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mAT1s),
  "predichos" = predict(mAT1s)))

ATs_ajuste$AT <- dataAT$TOTALS

library(ggplot2)
HVATs<-ggplot(ATs_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVATs

QQATs<-ggplot(ATs_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQATs

e<-resid(mAT1s) # residuos de pearson
pre<-predict(mAT1s) #predichos
alfai<-ranef(mAT1s)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mAT1s)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompATs<-emmeans(mAT1s, pairwise ~ MAD) #Tukey  
CompATs
plot(CompATs, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity" )

```

#### Conclusiones

La menor concentración de ácidos totales en frutos inmaduros es significativa.

### Ácido tartárico

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

tar<-subset(datap, CAR == "Tartárico")

# # Se quitan outliers
# g_caja<-boxplot(tar$CONS, col="green3", frame.plot=T)
# tar<-tar[!(tar$CONS %in% g_caja$out),]
# g_caja<-boxplot(tar$CONS, col="green3", frame.plot=T)
# tar<-tar[!(tar$CONS %in% g_caja$out),]

```

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mtar2s <- lme(CONS ~ MAD, random = ~ 1|REP,
             control = ctrl, data = tar)
mtar2s


tars_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mtar2s),
  "predichos" = predict(mtar2s)))

tars_ajuste$CONS <- tar$CONS

library(ggplot2)
HVtars<-ggplot(tars_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVtars

QQtars<-ggplot(tars_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQtars

e<-resid(mtar2s) # residuos de pearson
pre<-predict(mtar2s) #predichos
alfai<-ranef(mtar2s)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mtar2s)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Comptars<-emmeans(mtar2s, pairwise ~ MAD) #Tukey  
Comptars
plot(Comptars, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Maturity" )

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity. Sólo el estado sobre maduro presentó ácido málico detectable.

### Ácido málico

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

mal<-subset(datap, CAR == "Málico")

# Se quitan outliers
# g_caja<-boxplot(mal$CONS, col="green3", frame.plot=T)
# mal<-mal[!(mal$CONS %in% g_caja$out),]
# g_caja<-boxplot(mal$CONS, col="green3", frame.plot=T)
# mal<-mal[!(mal$CONS %in% g_caja$out),]

```

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mmal2s <- lme(CONS~ MAD, random = ~ 1|REP,
             weights=varIdent(form=~1|MAD),
             control = ctrl, data = mal)
mmal2s

mals_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mmal2s),
  "predichos" = predict(mmal2s)))

mals_ajuste$CONS <- mal$CONS

library(ggplot2)
HVmals<-ggplot(mals_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVmals

QQmals<-ggplot(mals_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQmals

e<-resid(mmal2s) # residuos de pearson
pre<-predict(mmal2s) #predichos
alfai<-ranef(mmal2s)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mmal2s)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compmals<-emmeans(mmal2s, pairwise ~ MAD) #Tukey  
Compmals
plot(Compmals, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Maturity" )

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity. En el estado maduro se presentó el pico de concentración de ácido málico.

### Ácido quínico

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

qui<-subset(datap, CAR == "Quínico")
# qui2<-qui[5:24,]
# Se quitan outliers
# g_caja<-boxplot(qui2$CONS, col="green3", frame.plot=F)
# qui<-qui2[!(qui2$CONS %in% g_caja$out),]

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

ctrl <- lmeControl(opt='optim');
mqui2s<- lme(CONS~MAD, random = ~ 1|REP,
                  weights=varIdent(form=~1|MAD),
                  control = ctrl, data = qui)
mqui2s

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


quis_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mqui2s),
  "predichos" = predict(mqui2s)))

quis_ajuste$CONS <- qui$CONS

library(ggplot2)
HVquis<-ggplot(quis_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVquis

QQquis<-ggplot(quis_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQquis

e<-resid(mqui2s) # residuos de pearson
pre<-predict(mqui2s) #predichos
alfai<-ranef(mqui2s)$REP$'(Intercept)'
shapiro.test(e)
# library(car)
# leveneTest(CONS~MAD, qui)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mqui2s)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compquis<-emmeans(mqui2s, pairwise ~ MAD) #Tukey  
Compquis
plot(Compquis, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Maturity" )

```

#### Conclusiones

El estado inmaduro se diferenció significativamente por sus bajas concentraciones de quínico. Luego durante la maduración el ácido se mantiene constante.

### Ácido succinico

#### Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

suc<-subset(datap, CAR == "Succínico")
ctrl <- lmeControl(opt='optim');
msuc2s<-lme(CONS~MAD, random = ~ 1|REP,
           control = ctrl, data = suc)

msuc2s

sucs_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(msuc2s),
  "predichos" = predict(msuc2s)))

sucs_ajuste$CONS <- suc$CONS

library(ggplot2)
HVsucs<-ggplot(sucs_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVsucs

QQsucs<-ggplot(sucs_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQsucs

e<-resid(msuc2s) # residuos de pearson
pre<-predict(msuc2s) #predichos
alfai<-ranef(msuc2s)$REP$'(Intercept)'
shapiro.test(e)
leveneTest(CONS~MAD, suc)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=7}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(msuc2s)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compsucs<-emmeans(msuc2s, pairwise ~ MAD) #Tukey  
Compsucs
plot(Compsucs, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Maturity" )

```

#### Conclusiones

Se encontraron diferencias significativas entre estados de Maturity, los frutos inmaduros y sobre maduros presentaron las mayores concentraciones de ácido succínico.


## Correlaciones ácidos orgánicos y acidez total titulable ATT.

### Tabla de ácidos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

corACn<-datap[-c(1:72,169:192),]
library(Rmisc)
estACcor <- summarySE(corACn, measurevar="CONS", groupvars=c("CAR","MAD"))
estadATcor<-subset(estadSACTS, CAR == "ACIDS")
estadATcor$CONS<-estadATcor$TOTALS
estadATcor<-estadATcor[,-c(4)]
estadATcor<-estadATcor[, c(1,2,3,7,4,5,6)] 
CTac<-rbind(estACcor,estadATcor)
CTac

```

## Comparación del perfil de ácidos y de ATT
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
GCac<-ggplot(CTac) +
  aes(MAD, CONS, fill=CAR, color=CAR) +
  geom_point()+
  scale_color_manual(values=c("aquamarine4","springgreen3","burlywood1","khaki3","coral1","tan3"))+
  scale_fill_manual(values=c("aquamarine4","springgreen3","burlywood1","khaki3","coral1","tan3"))+
  stat_summary(fun = "mean", size = 6, geom = "point") +
  geom_errorbar(aes(ymin=CONS-sd, ymax=CONS+sd),
                width=0, position=position_dodge(0)) +
  theme_classic()+
  labs(y="[mg/g dry fruit] for acids. %*100 for ATT", x="Maturity")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))+
  theme(legend.title = element_text("none"))
GCac

```
*The bars indicate standard deviation.*

## Concentración del ratio azúcares totales / ácidos orgánicos totales a distintos estados de Madurez.
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=12}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gSTAT<-ggplot2::ggplot(dataSTAT, aes(x=MAD, y=TOTALF, fill=MAD)) +
  geom_boxplot(width = 0.50)+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="Total sugar/Total acids", x="Maturity")+
  # facet_grid(CAR~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(legend.position = "none")
gSTAT

```

#### Tabla descriptiva totales
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
library(Rmisc)
dataSACT2<-dataSACT[-c(1:60),]
estadSACT2 <- summarySE(dataSACT2, measurevar="TOTALS", groupvars=c("MAD"))
estadSACT2

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mSTAT1 <- lme(TOTALS~ MAD, random = ~ 1|REP,
             control = ctrl, data = dataSTAT)

mSTAT1

STAT_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mSTAT1),
  "predichos" = predict(mSTAT1)))

STAT_ajuste$STAT <- dataSTAT$TOTALS

library(ggplot2)
HVSTAT<-ggplot(STAT_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVSTAT

QQSTAT<-ggplot(STAT_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQSTAT

e<-resid(mSTAT1) # residuos de pearson
# pre<-predict(mSTAT1) #predichos
# alfai<-ranef(mSTAT1)$REP$'(Intercept)'
shapiro.test(e)

```

#### Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mSTAT1)

```

#### Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompSTAT<-emmeans(mSTAT1, pairwise ~ MAD) #Tukey  
CompSTAT
plot(CompSTAT, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g fruta fresca", y ="Maturity")

```

#### Conclusiones

Existen diferencias significativas entre estados de Maturity para la relación azúcares totales / ácidos totales. La diferencia está dada únicamente entre los niveles MM y SM.

## Correlaciones
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# NTCac<-CTac[,-c(3,5:7)]
# NTCac<-spread(data = NTCac, key = CAR, value = CONS)
# 
# library(GGally)
# GCOR<-ggpairs(NTCac, columns = 2:7,lower = list(continuous = "points"))
# GCOR
```

### Correlaciones de Pearson.

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=12, fig.height=10}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

FACO<-read.delim("acidcor.txt")
FACO$MAD<-factor(FACO$MAD,levels=c("I", "MM", "M", "SM"))
colnames(FACO) <- c("MAD","Tartárico","Málico","Quínico" ,"Succínico","ACIDS","ATT")
FACO$Tartárico<-as.numeric(FACO$Tartárico)
FACO$Málico<-as.numeric(FACO$Málico)

# Creamos las variables Dummy
FACO$MADMM <- ifelse(FACO$MAD == "MM", 1, 0)
FACO$MADM <- ifelse(FACO$MAD == "M", 1, 0)
FACO$MADSM <- ifelse(FACO$MAD == "SM", 1, 0)

#Variables Dummy como categóricas

FACO$MADMM <- as.factor(FACO$MADMM)
FACO$MADM <- as.factor(FACO$MADM)
FACO$MADSM <- as.factor(FACO$MADSM)

library(ggplot2)
library(GGally)
GCORfaco <- ggpairs(FACO, columns = 2:7,lower = list(continuous = "points"))
GCORfaco
# ggplot2::aes(colour=MAD)) + ggplot2::scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   ggplot2::theme_classic()

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=12, fig.height=10}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

cor.test(FACO$Málico, FACO$Quínico)
cor.test(FACO$Tartárico, FACO$Succínico)
cor.test(FACO$ATT, FACO$Tartárico)
cor.test(FACO$ACIDS, FACO$Quínico)
cor.test(FACO$ACIDS, FACO$Málico)

```

### Gráficos de correlación detallados por estados de madurez

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=12, fig.height=10}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gac1 <- ggplot(FACO, aes(Quínico, Málico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

gac2 <- ggplot(FACO, aes(Succínico, Tartárico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

gac3 <- ggplot(FACO, aes(ATT, Tartárico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

gac4 <- ggplot(FACO, aes(ACIDS, Quínico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

gac5 <- ggplot(FACO, aes(ACIDS, Málico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

gac6 <- ggplot(FACO, aes(ACIDS, Succínico, color=MAD)) + 
  geom_point(size=3) + 
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.position = "none")

library(ggpubr)
ggarrange(gac1, gac2, gac3, gac4, gac5, gac6, common.legend = TRUE, legend = "bottom")

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# mquimal <- lm(data=FACO, Málico ~ Quínico + MADMM + MADM + MADSM)
# mtarsuc <- lm(data=FACO, Tartárico ~ Succínico + MADMM + MADM + MADSM)
# 
# summary(mquimal)
# summary(mtarsuc)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# FALTA CONVERTIR % a mg/g

# MRLMtar<-lm(data = FACO, ATT~Tartárico + MADMM + MADM + MADSM)

# MRLMmal<-lm(data = FACO, ATT~Málico + MADMM + MADM + MADSM)
# MRLMqui<-lm(data = FACO, ATT~Quínico + MADMM + MADM + MADSM)
# MRLMsuc<-lm(data = FACO, ATT~Succínico + MADMM + MADM + MADSM)
# MRLMaci<-lm(data = FACO, ATT~ACIDS + MADMM + MADM + MADSM)

# summary(MRLMtar)

# summary(MRLMmal)
# summary(MRLMqui)
# summary(MRLMsuc)
# summary(MRLMaci)

# MRLMtar2<-lm(data = FACO, ATT~Tartárico)
# summary(MRLMtar2)
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# AMRLMtar<-lm(data = FACO, ACIDS~Tartárico + MADMM + MADM + MADSM)
# AMRLMmal<-lm(data = FACO, ACIDS~Málico + MADMM + MADM + MADSM)
# AMRLMqui<-lm(data = FACO, ACIDS~Quínico + MADMM + MADM + MADSM)
# AMRLMsuc<-lm(data = FACO, ACIDS~Succínico + MADMM + MADM + MADSM)
# 
# summary(AMRLMtar)
# summary(AMRLMmal)
# summary(AMRLMqui)
# summary(AMRLMsuc)


```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(ggplot2)
# 
# # Transforma la salida del modelo en un data frame
# model_df2 <- data.frame(Quínico = FACO$Quínico,
#                        Málico = FACO$Málico,
#                        MAD = FACO$MAD,
#                        pred = predict(mquimal))
# 
# # Crea un gráfico de dispersión con la línea de regresión
# ggplot(model_df2, aes(x = Málico, y = Quínico, color = MAD)) + 
#   geom_point() + 
#   geom_smooth(method = "lm", se = FALSE) + 
#   ggtitle("Regresión lineal mixta") + 
#   xlab("Málico") + 
#   ylab("Quínico") +
#   theme_classic()+
#   theme(legend.position = "bottom") +
#   scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))


```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(ggplot2)
# 
# # Transforma la salida del modelo en un data frame
# model_df1 <- data.frame(Tartárico = FACO$Tartárico,
#                        Succínico = FACO$Succínico,
#                        MAD = FACO$MAD,
#                        pred = predict(mtarsuc))
# 
# # Crea un gráfico de dispersión con la línea de regresión
# ggplot(model_df1, aes(x = Succínico, y = Tartárico, color = MAD)) + 
#   geom_point() + 
#   geom_smooth(method = "lm", se = FALSE) + 
#   ggtitle("Regresión lineal mixta") + 
#   xlab("Succínico") + 
#   ylab("Tartárico")+
#   theme_classic()+
#   theme(legend.position = "bottom") +
#   scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))

# Sólo la correlación entre ácidos Succínico y Tartárico (r=0.687 , p=0.00824) es significativa, sin embargo éste último sólo se encuentra en pequeñas trazas en el fruto sobremaduro. La ATT no se correlaciona con los ácidos orgánicos estudiados por separado ni tampoco en su conjunto (totales), esto podría deberse a que el perfíl de ácidos y la ATT es relativamente constante durante la maduración. Finalmente, los ácidos totales sólo se correlacionaron significativamente con el ácido Málico (r=0.930 , p=0.002435) la estrecha relación se explicaría porque este ácido.

```

#### Conclusión

Linear relationships between organic acids became evident between Malic and Quinic acid with an r=0.8600213 and a p-value=0.000333, and between Tartaric and Succinic acid with an r=0.6869819 and a p-value=0.01358. Total titratable acidity (TTA) showed a significant linear association only with Tartaric acid with an r=-0.7187027 and a p-value=0.00845. However, this inverse association is linked to the fact that Tartaric acid only appears in trace amounts in overripe fruits. Total acids with Quinic acid presented a correlation of 0.8557676 with a p-value=0.0003839. Meanwhile, Malic acid  an r=0.9300893 and a p-value=1.169e-05. In both cases, these acids explain the increase in total acid concentration throughout fruit ripening.





