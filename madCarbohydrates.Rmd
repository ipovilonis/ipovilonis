---
title: "Carbohidratos"
output:
 html_document:
   toc: true
   toc_depth: 5
   toc_float:
     collapsed: false
     smooth_scroll: true
---

## Carbohidratos en peso fresco

```{r, echo=FALSE, error=TRUE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
datap<-read_excel("database.xlsx", sheet = "mad_CHac")
datap$CAR <- factor(datap$CAR,
                   levels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "TartÃ¡rico","MÃ¡lico","QuÃ­nico",  "SuccÃ­nico", "glufru", "ATT","TOTALac","TOTALaz"),
                   labels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "Tartárico","Málico","Quínico" ,"Succínico", "glufru", "ATT","TOTALac","TOTALaz"))
datap$REP<-as.factor(datap$REP)
datap$CONF<-as.numeric(datap$CONF)
datap$MAD<-factor(datap$MAD,levels=c("I", "MM", "M", "SM"))

data2<-datap[-c(73:168, 193:229),]

```

### Concentración de sacáridos a distintos estados de madurez
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
g1<-ggplot(data2[-c(73:96),], aes(x=MAD, y=CONF, color=MAD, width=1)) +
 geom_point(size=5)+
  facet_grid(.~CAR)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="mg/g PF", x="Madurez")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(axis.line.y = element_blank())
g1

```

 Tabla descriptiva
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estadcar <- summarySE(data2, measurevar="CONF", groupvars=c("CAR", "MAD"))
library(knitr)
kable(estadcar, format = "markdown")

```

 Evolución del perfíl de sacáridos en la maduración
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data4<-data2
data4<-data4[-c(73:119),]
dataSI<-subset(data4, MAD == "I")
dataSMM<-subset(data4, MAD == "MM")
dataM<-subset(data4, MAD == "M")
dataSSM<-subset(data4, MAD == "SM")


SI<-ggplot(dataSI, aes(x = "CAT", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2","red")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "INMADUROS")+
  theme(legend.title = element_blank())+
  xlab("[TS]") + ylab("mg/g fruta seca")

SMM<-ggplot(dataSMM, aes(x = "CAT", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2","red")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MEDIO MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[TS]") + ylab("mg/g fruta seca")

SM<-ggplot(dataM, aes(x = "CAT", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2","red")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[TS]") + ylab("mg/g fruta seca")

SSM<-ggplot(dataSSM, aes(x = "CAT", y = CONF, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2","red")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "SOBRE MADUROS")+
  theme(legend.title = element_blank())+
  xlab("[TS]") + ylab("mg/g fruta seca")

library(gridExtra)
grid.arrange(SI, SMM, SM, SSM, ncol = 2)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
sac<-subset(datap, CAR == "Sacarosa")
glu<-subset(datap, CAR == "Glucosa")
fru<-subset(datap, CAR == "Fructosa")
glufru<-subset(datap, CAR == "glufru")
dataST<-subset(datap, CAR == "TOTALaz")
```

### Carbohidratos Totales

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# gST<-ggplot2::ggplot(dataST, aes(x=MAD, y=CONF, fill=MAD)) +
#   geom_boxplot(width = 0.50)+
#   scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   labs(y="Totales (mg/g PF)", x="Madurez")+
#   # facet_grid(CAR~.)+
#   theme_classic()+
#   theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=20, color='black'))+
#   theme(axis.text = element_text(color='black'))+
#   theme(legend.title=element_blank())+
#   theme(legend.position = "none")+
# theme(axis.line.y = element_blank())

# gST

```

 Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mST1 <- lme(CONF~ MAD, random = ~ 1|REP,
             control = ctrl, data = dataST)

mST1


ST_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mST1),
  "predichos" = predict(mST1)))

ST_ajuste$CONF <- dataST$CONF

library(ggplot2)
HVST<-ggplot(ST_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVST

QQST<-ggplot(ST_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQST

e<-resid(mST1) # residuos de pearson
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mST1)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompmST1<-emmeans(mST1, pairwise ~ MAD) #Tukey  
CompmST1
plot(CompmST1, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g PF", y ="Madurez" )

```

### Sacarosa

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
msac2<-lme(CONF~MAD, random = ~ 1|REP,
           control = ctrl, data = sac)
msac2

sac_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(msac2),
  "predichos" = predict(msac2)))

sac_ajuste$CONF <- sac$CONF

library(ggplot2)
HVsac<-ggplot(sac_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVsac

QQsac<-ggplot(sac_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQsac

e<-resid(msac2) # residuos de pearson
pre<-predict(msac2) #predichos
alfai<-ranef(msac2)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(msac2)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compsac<-emmeans(msac2, pairwise ~ MAD) #Tukey  
Compsac
plot(Compsac, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

 Conclusiones

Los frutos inmaduros tuvieron una concentración de sacarosa significativamente menor.

### Glucosa

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
mglu2<-lme(CONF~MAD, random = ~ 1|REP,
           control = ctrl, data = glu)
mglu2

glu_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mglu2),
  "predichos" = predict(mglu2)))

glu_ajuste$CONF <- glu$CONF

library(ggplot2)
HVglu<-ggplot(glu_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVglu

QQglu<-ggplot(glu_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQglu

e<-resid(mglu2) # residuos de pearson
pre<-predict(mglu2) #predichos
alfai<-ranef(mglu2)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(mglu2)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compglu<-emmeans(mglu2, pairwise ~ MAD) #Tukey  
Compglu
plot(Compglu, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

 Conclusiones

### Fructosa

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
mfru2<-lme(CONF~MAD, random = ~ 1|REP,
           control = ctrl, data = fru)
mfru2

fru_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mfru2),
  "predichos" = predict(mfru2)))

fru_ajuste$CONF <- fru$CONF

library(ggplot2)
HVfru<-ggplot(fru_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVfru

QQfru<-ggplot(fru_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQfru

e<-resid(mfru2) # residuos de pearson
pre<-predict(mfru2) #predichos
alfai<-ranef(mfru2)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(mfru2)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compfru<-emmeans(mfru2, pairwise ~ MAD) #Tukey  
Compfru
plot(Compfru, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

 Conclusiones


## Carbohidratos en peso seco

### Carbohidratos Totales

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
gSTs<-ggplot(data2[-c(73:96),], aes(x=MAD, y=CONS, color=MAD, width=1)) +
 geom_point(size=5)+
  facet_grid(.~CAR)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="mg/g PS", x="Madurez")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(axis.line.y = element_blank())
gSTs

```

 Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mST1s <- lme(CONS~ MAD, random = ~ 1|REP,
             control = ctrl, data = dataST)

mST1s


STs_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mST1),
  "predichos" = predict(mST1)))

STs_ajuste$ST <- dataST$CONS

library(ggplot2)
HVSTs<-ggplot(STs_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVSTs

QQSTs<-ggplot(STs_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQSTs

e<-resid(mST1s) # residuos de pearson
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mST1s)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompmST1s<-emmeans(mST1s, pairwise ~ MAD) #Tukey  
CompmST1s
plot(CompmST1s, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración mg/g PF", y ="Madurez" )

```

 Conclusiones


### Sacarosa

 Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
msac2s<-lme(CONS~MAD, random = ~ 1|REP,
           control = ctrl, data = sac)
msac2s

sacs_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(msac2s),
  "predichos" = predict(msac2s)))

sacs_ajuste$CONS <- sac$CONS

library(ggplot2)
HVsacs<-ggplot(sacs_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVsacs

QQsacs<-ggplot(sacs_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQsacs

e<-resid(msac2) # residuos de pearson
pre<-predict(msac2) #predichos
alfai<-ranef(msac2)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(msac2s)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Compsacs<-emmeans(msac2s, pairwise ~ MAD) #Tukey  
Compsacs
plot(Compsacs, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

 Conclusiones
Se encontraron diferencias significativas entre estados de madurez. Los frutos maduros tendrían mayor concentración de sacarosa, no se diferenciaron de los frutos medios maduros.

### Glucosa

 Modelo y supuestos
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(nlme)
ctrl <- lmeControl(opt='optim');
mglu2s <- lme(CONS ~ MAD, random = ~ 1|REP,
             weights=varIdent(form=~1|MAD),
             control = ctrl,data = glu)
mglu2s

glus_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mglu2s),
  "predichos" = predict(mglu2s)))

glus_ajuste$CONS <- glu$CONS

library(ggplot2)
HVglus<-ggplot(glus_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVglus

QQglus<-ggplot(glus_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQglus


e<-resid(mglu2s) # residuos de pearson
pre<-predict(mglu2s) #predichos
alfai<-ranef(mglu2s)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(mglu2s)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compglus<-emmeans(mglu2s, pairwise ~ MAD) #Tukey  
Compglus
plot(Compglus, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

### Fructosa

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
mfru2s<-lme(CONS~MAD, random = ~ 1|REP,
           control = ctrl, data = fru)
mfru2s

frus_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mfru2s),
  "predichos" = predict(mfru2s)))

frus_ajuste$CONS <- fru$CONS

library(ggplot2)
HVfrus<-ggplot(frus_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVfrus

QQfrus<-ggplot(frus_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQfrus

e<-resid(mfru2s) # residuos de pearson
pre<-predict(mfru2s) #predichos
alfai<-ranef(mfru2s)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(mfru2s)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compfrus<-emmeans(mfru2s, pairwise ~ MAD) #Tukey  
Compfrus
plot(Compfrus, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

### Glucosa/Fructosa

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(lme4)
ctrl <- lmeControl(opt='optim');
mglufru2s<-lme(CONS~MAD, random = ~ 1|REP,
              weights=varIdent(form=~1|MAD),
              control = ctrl, data = glufru)
mglufru2s

glufrus_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mglufru2s),
  "predichos" = predict(mglufru2s)))

glufrus_ajuste$CONS <- glufru$CONS

library(ggplot2)
HVglufrus<-ggplot(glufrus_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVglufrus

QQglufrus<-ggplot(glufrus_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQglufrus

e<-resid(mglufru2s) # residuos de pearson
pre<-predict(mglufru2s) #predichos
alfai<-ranef(mglufru2s)$REP$'(Intercept)'
shapiro.test(e)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(car)
anova(mglufru2s)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Compglufrus<-emmeans(mglufru2s, pairwise ~ MAD) #Tukey  
Compglufrus
plot(Compglufrus, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )

```

## Alimdón en peso fresco

M&M: se cuantificó almidón por el método del YODO según [Lage *et al.*, (1983)](https://www.researchgate.net/profile/Jesus-Simal-Lozano/publication/235700249_Determinacion_de_almidon_en_alimentos/links/02bfe513dc78894e15000000/Determinacion-de-almidon-en-alimentos.pdf)

+Reactivos
- Acido perclórico 52% (w/w).
- Solución de yodo-yoduro potásico: 20 g de yoduro potásico, disueltos en 20 ml de
agua destilada y 2,0 g de yodo llevados a 1 litro.
- Muestras de fruto de ubajay inmaduras (I), medio maduras (MM), maduras(M) y sobremaduras (SM)

+Lectura en espectrofotómetro a 600nm

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

ALMI<-read_excel("database.xlsx", sheet = "mad_Almi")
ALMI$MAD<-factor(ALMI$MAD,levels=c("I", "MM", "M", "SM"))

# library(ggplot2)
# galmi2<-ggplot2::ggplot(ALMI, aes(x=MAD, y=STARCH, fill=MAD, width=1)) +
#   geom_point()+
#   scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   labs(y="g/100 g PF", x="Madurez")+
#   theme_classic()+
#   theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=20, color='black'))+
#   theme(axis.text = element_text(color='black'))+
#   theme(legend.title=element_blank())+
#   theme(legend.position = "none")+
#   theme(axis.line.y = element_blank())
# galmi2

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estalmi <- summarySE(ALMI, measurevar="STARCH", groupvars=c("MAD"))
library(knitr)
kable(estalmi, format = "markdown")brary(ggplot2)
# galmi2<-ggplot2::ggplot(estalmi, aes(x=MAD, y=STARCH, color=MAD, width=1))+
#   stat_summary(fun = "mean", size = 6, geom = "point") +
#   geom_errorbar(aes(ymin=STARCH-sd, ymax=STARCH+sd),
#                 width=0, position=position_dodge(0))+
#   scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   labs(y="g almidon/100 g PF", x="Madurez")+
#   theme_classic()+
#   theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=20, color='black'))+
#   theme(axis.text = element_text(color='black'))+
#   theme(legend.title=element_blank())+
#   theme(legend.position = "none")+
#   theme(axis.line.y = element_blank())
# galmi2

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
galmi3<-ggplot2::ggplot(ALMI, aes(x=MAD, y=STARCH, color=MAD, width=1))+
  geom_point(size=9)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="g almidon/100 g PF", x="Madurez")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(axis.line.y = element_blank())+
  ylim(0,4)
galmi3

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


mSTARCH <- lm(STARCH ~ MAD,
              data = ALMI)

library(nlme)
mSTARCH2 <- gls(STARCH ~ MAD,
              weights = varIdent(form=~1|MAD),
              data = ALMI)

AIC(mSTARCH,mSTARCH2)

STARCH_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mSTARCH),
  "predichos" = predict(mSTARCH)))

STARCH_ajuste$STARCH <- ALMI$STARCH

library(ggplot2)
HVSTARCH<-ggplot(STARCH_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVSTARCH

QQSTARCH<-ggplot(STARCH_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQSTARCH

e<-resid(mSTARCH) # residuos de pearson
pre<-predict(mSTARCH) #predichos
shapiro.test(e)
leveneTest(mSTARCH)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mSTARCH)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompSTARCH<-emmeans(mSTARCH, pairwise ~ MAD) #Tukey  
CompSTARCH
plot(CompSTARCH, comparisons = TRUE) + theme_classic() + 
  labs(x = "Concentración", y ="Madurez" )+
  theme_classic()+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='green'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))

```

## Almidón en peso seco

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

ALMI<-read_excel("database.xlsx", sheet = "mad_Almi")
ALMI$MAD<-factor(ALMI$MAD,levels=c("I", "MM", "M", "SM"))

# library(ggplot2)
# galmi2s<-ggplot2::ggplot(ALMI, aes(x=MAD, y=STARCHs, fill=MAD, width=1)) +
#   geom_boxplot()+
#   scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   labs(y="g/100 g fruta seca", x="Madurez")+
#   theme_classic()+
#   theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=20, color='black'))+
#   theme(axis.text = element_text(color='black'))+
#   theme(legend.title=element_blank())+
#   theme(legend.position = "none")+
#   theme(axis.line.y = element_blank())
# galmi2s
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estalmis <- summarySE(ALMI, measurevar="STARCHs", groupvars=c("MAD"))
library(knitr)
kable(estalmis, format = "markdown")brary(ggplot2)
# library(ggplot2)
# galmi3s<-ggplot2::ggplot(estalmi, aes(x=MAD, y=STARCHs, color=MAD, width=1))+
#   stat_summary(fun = "mean", size = 6, geom = "point") +
#   geom_errorbar(aes(ymin=STARCHs-sd, ymax=STARCHs+sd),
#                 width=0, position=position_dodge(0))+
#   scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
#   labs(y="g almidon/100 g fruta seca", x="Madurez")+
#   theme_classic()+
#   theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=20, color='black'))+
#   theme(axis.text = element_text(color='black'))+
#   theme(legend.title=element_blank())+
#   theme(legend.position = "none")+
#   theme(axis.line.y = element_blank())
# galmi3s

```

Las barras indican desvío estándar.

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
galmi4s<-ggplot2::ggplot(ALMI, aes(x=MAD, y=STARCHs, color=MAD, width=1))+
  geom_point(size=9)+
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="g almidon/100 g fruta seca", x="Madurez")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme(axis.line.y = element_blank())
galmi4s

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


mSTARCHs <- lm(STARCHs ~ MAD,
              data = ALMI)

library(nlme)
mSTARCHs2 <- gls(STARCHs ~ MAD,
              weights = varIdent(form=~1|MAD),
              data = ALMI)

# AIC(mSTARCHs,mSTARCHs2)

STARCHs_ajuste <- as.data.frame(cbind(
  "residuos" = residuals(mSTARCHs),
  "predichos" = predict(mSTARCHs)))

STARCHs_ajuste$STARCHs <- ALMI$STARCHs

library(ggplot2)
HVSTARCHs<-ggplot(STARCHs_ajuste) +
  aes(predichos, residuos) +
  geom_hline(yintercept = 0, colour="white", size=2) +
  geom_point(colour="white")+
  theme_classic()+
  labs(y="Residuals", x="Predicted values")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
HVSTARCHs

QQSTARCHs<-ggplot(STARCHs_ajuste) +
  aes(sample = residuos) +
  geom_qq(shape = 1, colour="white") +
  geom_qq_line(colour="white")+
  theme_classic()+
  labs(y="Sample Quantiles", x="Theoretical Quantiles")+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))
QQSTARCHs

e<-resid(mSTARCHs) # residuos de pearson
pre<-predict(mSTARCHs) #predichos
shapiro.test(e)
# leveneTest(mSTARCHs)

```

 Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(mSTARCHs)

```

 Test de Tukey
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
CompSTARCHs<-emmeans(mSTARCHs, pairwise ~ MAD) #Tukey  
CompSTARCHs
plot(CompSTARCHs, comparisons = T) + theme_classic() +
  labs(x = "Concentración", y ="Madurez" )+
  theme_classic()+
  theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
  theme(panel.grid.major.y = element_line(size=0.05, color='green'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='white'))+
  theme(axis.text = element_text(color='white'))+
  theme(plot.background = element_rect(fill = "gray12"))+
  theme(panel.background = element_rect(fill = "gray12", color = "white"))


```
