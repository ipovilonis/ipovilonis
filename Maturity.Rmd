---
title: "Maturity"
output:
 html_document:
   toc: true
   toc_depth: 5
   toc_float:
     collapsed: false
     smooth_scroll: true
---

The aim of this work was to study the evolution of fruit size and weight together with the
soluble solid and total titratable acidity contents with the patterns of accumulation of chlorophylls, carotenoids, phenols and antioxidant activity during ripening of *Hexachlamys edulis* fruits, to understand the optimal time and conditions needed to obtain maximum nutraceutical characteristics. Fruits were harvested from H. edulis plants growing at the experimental field of the University of Morón (Moreno, Buenos Aires, 34°35'4.98" SL, 58°48'52.09" WL, 14 m.a.s.l.).

# Variables físicas

## Peso fresco del fruto (PFF)

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data<-read.delim("madurez.txt")
data$MADUREZ<-as.factor(data$MADUREZ)
data$MADUREZ<-factor(data$MADUREZ,levels=c("Inmaduro", "Medio Maduro", "Maduro", "SobreMaduro"))

```

### Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estad <- summarySE(data, measurevar="PFF", groupvars=c("MADUREZ"))
estad

```

### Gráfico con desvío estándar
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
ggplot(estad, aes(x=MADUREZ, y=PFF, color=MADUREZ)) +
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  stat_summary(fun = "mean", size = 6, geom = "point") +
  geom_errorbar(aes(ymin=PFF-sd, ymax=PFF+sd),
                width=.2, position=position_dodge(.9)) +  
  ylab("PFF")+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )+
  ylim(0,80)

```



```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

graf1<- ggplot(data, aes(MADUREZ, PFF, fill=MADUREZ)) +  
  geom_boxplot()+labs(y="PFF")+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )+
  ylim(0,80)
graf1

```

### Relacion media-varianza
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

estad$var=estad$sd^2#agrego varianza
vs<-ggplot(estad, aes(x=PFF, y=var))+geom_point(size=4) +   
  geom_smooth(method="lm", se = FALSE, color="red", linetype="dashed") + xlab("Media") +
  ylab("Varianza") +  ggtitle("Relaci?n media - varianza")+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )
vs

```

### Modelos

* M0: modelo sólo con el factor fijo madurez.
* M1: M0 + modelado de la varinza por varIdent
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

M0<- lm(PFF ~ MADUREZ ,data)

library(nlme)
M1 <- gls(PFF ~ MADUREZ, weights=varIdent(form=~1|MADUREZ), data = data)

```

### Eleccción de modelos por AIC
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

AIC(M0, M1)

```
Se elije el modelo M1

### Verificación de supuestos
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

e<-resid(M1) # residuos
rest <- resid(M1, type="normalized") #residuos estandarizados
pre<-predict(M1) #predichos

par(mfrow = c(1, 2))
plot(pre, rest, xlab="Predichos", ylab="Residuos estandarizados",main="Gr?fico de dispersi?n de RE vs PRED" )
abline(0,0)
qqnorm(e)
qqline(e)
shapiro.test(e)
par(mfrow = c(1, 1))
library(car)
leveneTest(PFF~MADUREZ, data, center=mean)

```

### Anova
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(M1)

```

### Comparaciones a posteriori
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Comp2<-emmeans(M0, pairwise ~ MADUREZ) #Tukey por default  
Comp2
plot(Comp2, comparisons = TRUE)

```


## Peso seco de fruto (PSF)

### Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
estad <- summarySE(data, measurevar="PSF", groupvars=c("MADUREZ"))
estad

```

### Gráfico con desvío estándar
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
ggplot(estad, aes(x=MADUREZ, y=PSF, color=MADUREZ)) +
  scale_color_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  stat_summary(fun = "mean", size = 6, geom = "point") +
  geom_errorbar(aes(ymin=PSF-sd, ymax=PSF+sd),
  width=.2,                    # Width of the error bars
  position=position_dodge(.9)) +  
  ylab("PSF")+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )+
  ylim(0,13)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

graf2<- ggplot(data, aes(MADUREZ, PSF, fill=MADUREZ)) +  
  geom_boxplot()+labs(y="PSF")+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )+
  ylim(0,13)
graf2

```

### Relacion media-varianza
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

estad$var=estad$sd^2#agrego varianza
vs<-ggplot(estad, aes(x=PSF, y=var))+geom_point(size=4) +   
  geom_smooth(method="lm", se = FALSE, color="red", linetype="dashed") + xlab("Media") +
  ylab("Varianza") +  ggtitle("Relaci?n media - varianza")+
  theme_classic()+
  theme(legend.title=element_blank())+
  theme(legend.position = "none" )
vs

```

### Modelos

* M0s: modelo sólo con el factor fijo madurez.
* M1s: M0 + modelado de la varinza por varIdent
* M1si: M1 con variable respuesta inversa (1/Y)
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# MODELOS
M0s<- lm(PSF ~ MADUREZ ,data)

library(nlme)
M1s <- gls(PSF ~ MADUREZ, weights=varIdent(form=~1|MADUREZ), data = data)
M1si <- gls(1/PSF ~ MADUREZ, weights=varIdent(form=~1|MADUREZ), data = data)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

AIC(M1s, M1si)

```

Se elije el modelo M1si

### Verificación de supuestos
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

e<-resid(M1si) # residuos
rest <- resid(M1si, type="normalized") #residuos estandarizados
pre<-predict(M1si) #predichos

par(mfrow = c(1, 2))
plot(pre, rest, xlab="Predichos", ylab="Residuos estandarizados",main="Gr?fico de dispersi?n de RE vs PRED" )
abline(0,0)
qqnorm(e)
qqline(e)
shapiro.test(e)
par(mfrow = c(1, 1))
library(car)
leveneTest(PSF~MADUREZ, data, center=mean)

```

### Anova
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(M1si)

```

### Comparaciones a posteriori
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(emmeans)
library(multcompView)
Comp2<-emmeans(M0, pairwise ~ MADUREZ) #Tukey por default  
Comp2
plot(Comp2, comparisons = TRUE)

```

# Variables químicas

The objective of this second part is to study the organic acids, carbohydrates and cations in the different stages of maturity.

## Acidos orgánicos

```{r, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data<-read.delim("CHac.txt")
data$CAR <- factor(data$CAR,
                   levels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "TartÃ¡rico","MÃ¡lico","QuÃ­nico",  "SuccÃ­nico"),
                   labels = c("Sacarosa" ,"Glucosa" ,"Fructosa" ,
                              "Tartárico","Málico","Quínico" ,"Succínico"))
data$REP<-as.factor(data$REP)
data$CON<-as.numeric(data$CON)
data$MAD<-factor(data$MAD,levels=c("I", "MM", "M", "SM"))

data2<-data[-c(73:168),]
data3<-data[-c(1:96),]

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
g2<-ggplot2::ggplot(data3, aes(x=MAD, y=CON, fill=MAD, width=1)) +
  geom_boxplot()+
  facet_grid(CAR~.)+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  labs(y="mg/g fruta seca", x="Madurez")+
  theme(panel.grid.major.x = element_blank())+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20))+
  theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  theme_classic()
g2

```


```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data5<-data3
dataSI<-subset(data5, MAD == "I")
dataSMM<-subset(data5, MAD == "MM")
dataM<-subset(data5, MAD == "M")
dataSSM<-subset(data5, MAD == "SM")


SI<-ggplot(dataSI, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Ácidos en frutos INMADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SMM<-ggplot(dataSMM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Ácidos en frutos MEDIO MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SM<-ggplot(dataM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Ácidos en frutos MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SSM<-ggplot(dataSSM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Ácidos en frutos SOBRE MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

library(gridExtra)
grid.arrange(SI, SMM, SM, SSM, ncol = 2)

```

## Carbohidratos
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

g1<-ggplot(data2, aes(x=MAD, y=CON, fill=MAD, width=1)) +
  facet_grid(CAR~.)+
  geom_boxplot()+
  labs(y="mg/g fruta seca", x="Madurez")+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20))+
  theme(legend.title=element_blank())+
  theme(legend.position = "none")+
  theme_classic()+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))+
  geom_point(aes(colour=REP))+
  scale_colour_manual(values = c("cyan4", "coral1","green3"))
  
g1

```


```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data4<-data2
dataSI<-subset(data4, MAD == "I")
dataSMM<-subset(data4, MAD == "MM")
dataM<-subset(data4, MAD == "M")
dataSSM<-subset(data4, MAD == "SM")


SI<-ggplot(dataSI, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Sacáridos en frutos INMADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SMM<-ggplot(dataSMM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Sacáridos en frutos MEDIO MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SM<-ggplot(dataM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Sacáridos en frutos MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

SSM<-ggplot(dataSSM, aes(x = "CAT", y = CON, fill = CAR)) +
  geom_col(width = 1) +
  scale_fill_manual(values = c("coral","coral3","burlywood2")) +
  coord_polar("y", start = pi / 3) +
  labs(title = "Sacáridos en frutos SOBRE MADUROS")+
  theme(legend.title = element_blank())+
  xlab("") + ylab("mg/g fruta seca")

library(gridExtra)
grid.arrange(SI, SMM, SM, SSM, ncol = 2)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)



```

## Cationes
```{r, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data<-read.delim("cationes.txt")
data$MAD<-as.factor(data$MAD)
data$CAT<-as.factor(data$CAT)
data$MAD<-factor(data$MAD,levels=c("I", "MM", "M", "SM"))
data[is.na(data)] <-  0
mg<-data[1:12,]
k<-data[13:24,]
mn<-data[25:36,]
```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
gmg<-ggplot(mg, aes(x=MAD, y=CON, fill=MAD))+
  geom_hline(yintercept=0, col="darkgray")+
  geom_boxplot()+
  theme_bw()+
  theme(legend.position = "none")+
  theme(legend.title = element_blank())+
  xlab("") +  ylab("Concentración de Mg (mg/g)") +
  ggtitle("")+
  geom_hline(yintercept = 0)+
  geom_point(aes(x=3, y=0.1115), colour="red", size=2, shape=18) + #Rozycki 1997
  annotate("text", x = c(3), y = c(0.109), label = c("Rozycki et al., 1997"))+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))
gmg

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gk<-ggplot(k, aes(x=MAD, y=CON, fill=MAD))+
  geom_hline(yintercept=0, col="darkgray")+
  geom_boxplot()+
  theme_bw()+
  theme(legend.position= "none")+
  theme(legend.title = element_blank())+
  xlab("") +  ylab("Concentración de K (mg/g)") +
  ggtitle("")+
  geom_hline(yintercept = 0)+
  geom_point(aes(x=3, y=0.97), colour="blue4", size=5, shape=18)+
  geom_point(aes(x=3, y=0.9485), colour="red", size=2, shape=18)+ #Rozycki
  annotate("text", x = c(3, 3), y = c(0.85, 1.1), label = c("Rozycki et al., 1997" , "UNLu"))+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))
gk

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

gmn<-ggplot(mn, aes(x=MAD, y=CON, fill=MAD))+
  geom_hline(yintercept=0, col="darkgray")+
  ylim(0,0.005)+
  geom_boxplot()+
  theme_bw()+
  theme(legend.position = "none")+
  theme(legend.title = element_blank())+
  xlab("Estados de madurez") +  ylab("Concentración de Mn (mg/g)") +
  ggtitle("")+
  geom_hline(yintercept = 0)+
  ylim(0,0.003)+
  scale_fill_manual(values=c("palegreen4","green2","orange","burlywood2"))
gmn

```

