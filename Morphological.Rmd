---
title: "Morphological"
runtime: shiny
---

![The fruit](C:/Users/um/Documents/ipovilonis/Doc/6 - Producción/test/ipovilonis.github.io)

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
fisico<- read_excel("database.xlsx", sheet="fisico")

fisico$year<-as.factor(fisico$year)
fisico$phenotype<-as.factor(fisico$phenotype)
fisico$site<-factor(fisico$site,levels=c("concordia", "palmar","gualeguaychu"))
fisico$n<-as.factor(fisico$n)
fisico$pss<-as.numeric(fisico$pss)
fisico$mad<-as.numeric(fisico$mad)
data19F<-subset(fisico, year == "2019")

```

# Average fruit

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


# library(tidyr)
# fisico %>% drop_na()

variable<-c("Fresh fruit weight","Dry fruit weight","Dry seed weight","Dry pulp weight", "Dry pulp/fresh fruit weight (%)")
means<-c(mean(fisico$pff), (mean(fisico$psf, na.rm=T)), (mean(fisico$pss, na.rm=T)),((mean(fisico$psf, na.rm=T))-(mean(fisico$pss, na.rm=T))), (0.6311753*100/18.5236420))

fruit<-data.frame(variable,means)
fruit
```

# Maturity index

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data<-read_excel("database.xlsx", sheet="varqui")
data$year<-as.factor(data$year)
data$phenotype<-as.factor(data$phenotype)
data$site<-factor(data$site,levels=c("concordia", "palmar","gualeguaychu"))
data19Q<-subset(data, year == "2019")

library(Rmisc)
resindmad <- summarySE(data19Q, measurevar="indmad", groupvars=c("site","phenotype"), na.rm = TRUE)
resindmad

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gindmad<-ggplot(data=resindmad, aes(x=phenotype, y=indmad, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=indmad-sd, ymax=indmad+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Fruit Maturity Index")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gindmad
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

dataindmad <- data19Q[!is.na(data19Q$indmad),]

library(lme4)
library(lmerTest)

mindmad<- lmer((indmad) ~ 1 + (1|site/phenotype), dataindmad)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# indmad_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mindmad),
#   "predichos" = predict(mindmad)))
# 
# indmad_ajuste$indmad <- dataindmad$indmad
# 
# library(ggplot2)
# HVindmad<-ggplot(indmad_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVindmad
# 
# QQindmad<-ggplot(indmad_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQindmad
# 
# e<-resid(mindmad) # residuos de pearson
# # pre<-predict(mindmad) #predichos
# # alfai<-ranef(mindmad)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mindmad)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

FRUpindmad<-(summary(mindmad)$sigma)^2
phenotypepindmad<-as.numeric(VarCorr(mindmad)$"phenotype:site")
sitepindmad<-as.numeric(VarCorr(mindmad)$"site")

ICCfindmad<-FRUpindmad/(FRUpindmad+phenotypepindmad+sitepindmad)
ICCaindmad<-(phenotypepindmad)/(FRUpindmad+phenotypepindmad+sitepindmad)
ICCrindmad<-sitepindmad/(FRUpindmad+phenotypepindmad+sitepindmad)
ICCindmad<-performance::icc(mindmad)
  
ICCfindmad*100
ICCaindmad*100
ICCrindmad*100
ICCindmad

```

# pff 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
respff <- summarySE(data19F, measurevar="pff", groupvars=c("site","phenotype"), na.rm = TRUE)
respff

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gpff<-ggplot(data=respff, aes(x=phenotype, y=pff, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=pff-sd, ymax=pff+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Fresh fruit weight [g]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gpff
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

datapff <- data19F[!is.na(data19F$pff),]

library(lme4)
library(lmerTest)

mpff<- lmer(sqrt(pff) ~ 1 + (1|site/phenotype), datapff)
# 
# library(nlme)
# mpff2<- lme(sqrt(pff) ~ 1, random = 1 | site/phenotype, datapff)

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# pff_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mpff),
#   "predichos" = predict(mpff)))
# 
# pff_ajuste$pff <- datapff$pff
# 
# library(ggplot2)
# HVpff<-ggplot(pff_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVpff
# 
# QQpff<-ggplot(pff_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQpff
# 
# e<-resid(mpff) # residuos de pearson
# # pre<-predict(mpff) #predichos
# # alfai<-ranef(mpff)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mpff)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# summary(mpff2)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

FRUppff<-(summary(mpff)$sigma)^2 #Ruido/error aleatorio
phenotypeppff<-as.numeric(VarCorr(mpff)$"phenotype:site") #Variación entre ind de una misma siteión
siteppff<-as.numeric(VarCorr(mpff)$"site") #Variación entre siteiones

ICCfpff<-FRUppff/(FRUppff+phenotypeppff+siteppff)
ICCapff<-(phenotypeppff)/(FRUppff+phenotypeppff+siteppff)
ICCrpff<-siteppff/(FRUppff+phenotypeppff+siteppff)
ICCpff<-performance::icc(mpff)
ICCphenotypepff<-(phenotypeppff+siteppff)/(FRUppff+phenotypeppff+siteppff)
  
ICCfpff*100
ICCapff*100
ICCrpff*100
ICCpff
ICCphenotypepff
```


# psf 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
respsf <- summarySE(data19F, measurevar="psf", groupvars=c("site","phenotype"), na.rm = TRUE)
respsf

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gpsf<-ggplot(data=respsf, aes(x=phenotype, y=psf, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=psf-sd, ymax=psf+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Dry fruit weight [g]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gpsf
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

datapsf <- data19F[!is.na(data19F$psf),]

library(lme4)
library(lmerTest)

mpsf<- lmer((psf)^(1/2) ~ 1 + (1|site/phenotype), datapsf)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# psf_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mpsf),
#   "predichos" = predict(mpsf)))
# 
# psf_ajuste$psf <- datapsf$psf
# 
# library(ggplot2)
# HVpsf<-ggplot(psf_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVpsf
# 
# QQpsf<-ggplot(psf_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQpsf
# 
# e<-resid(mpsf) # residuos de pearson
# # pre<-predict(mpsf) #predichos
# # alfai<-ranef(mpsf)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mpsf)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

FRUppsf<-(summary(mpsf)$sigma)^2
phenotypeppsf<-as.numeric(VarCorr(mpsf)$"phenotype:site")
siteppsf<-as.numeric(VarCorr(mpsf)$"site")

ICCfpsf<-FRUppsf/(FRUppsf+phenotypeppsf+siteppsf)
ICCapsf<-(phenotypeppsf)/(FRUppsf+phenotypeppsf+siteppsf)
ICCrpsf<-siteppsf/(FRUppsf+phenotypeppsf+siteppsf)
ICCpsf<-performance::icc(mpsf)
  
ICCfpsf*100
ICCapsf*100
ICCrpsf*100
ICCpsf

```

# de 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
resde <- summarySE(data19F, measurevar="de", groupvars=c("site","phenotype"), na.rm = TRUE)
resde

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gde<-ggplot(data=resde, aes(x=phenotype, y=de, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=de-sd, ymax=de+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Ecuatorial diametrer [mm]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gde
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

datade <- data19F[!is.na(data19F$de),]

library(lme4)
library(lmerTest)

mde<- lmer((de) ~ 1 + (1|site/phenotype), datade)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# de_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mde),
#   "predichos" = predict(mde)))
# 
# de_ajuste$de <- datade$de
# 
# library(ggplot2)
# HVde<-ggplot(de_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVde
# 
# QQde<-ggplot(de_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQde
# 
# e<-resid(mde) # residuos de pearson
# # pre<-predict(mde) #predichos
# # alfai<-ranef(mde)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mde)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

FRUpde<-(summary(mde)$sigma)^2
phenotypepde<-as.numeric(VarCorr(mde)$"phenotype:site")
sitepde<-as.numeric(VarCorr(mde)$"site")

ICCfde<-FRUpde/(FRUpde+phenotypepde+sitepde)
ICCade<-(phenotypepde)/(FRUpde+phenotypepde+sitepde)
ICCrde<-sitepde/(FRUpde+phenotypepde+sitepde)
ICCde<-performance::icc(mde)
  
ICCfde*100
ICCade*100
ICCrde*100
ICCde

```

# dp 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
resdp <- summarySE(data19F, measurevar="dp", groupvars=c("site","phenotype"), na.rm = TRUE)
resdp

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gdp<-ggplot(data=resdp, aes(x=phenotype, y=dp, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=dp-sd, ymax=dp+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="polar diameter [mm]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gdp
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

datadp <- data19F[!is.na(data19F$dp),]

library(lme4)
library(lmerTest)

mdp<- lmer((dp) ~ 1 + (1|site/phenotype), datadp)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# dp_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mdp),
#   "predichos" = predict(mdp)))
# 
# dp_ajuste$dp <- datadp$dp
# 
# library(ggplot2)
# HVdp<-ggplot(dp_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVdp
# 
# QQdp<-ggplot(dp_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQdp
# 
# e<-resid(mdp) # residuos de pearson
# # pre<-predict(mdp) #predichos
# # alfai<-ranef(mdp)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mdp)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

FRUpdp<-(summary(mdp)$sigma)^2
phenotypepdp<-as.numeric(VarCorr(mdp)$"phenotype:site")
sitepdp<-as.numeric(VarCorr(mdp)$"site")

ICCfdp<-FRUpdp/(FRUpdp+phenotypepdp+sitepdp)
ICCadp<-(phenotypepdp)/(FRUpdp+phenotypepdp+sitepdp)
ICCrdp<-sitepdp/(FRUpdp+phenotypepdp+sitepdp)
ICCdp<-performance::icc(mdp)
  
ICCfdp*100
ICCadp*100
ICCrdp*100
ICCdp

```

# ns 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
resns <- summarySE(data19F, measurevar="ns", groupvars=c("site","phenotype"), na.rm = TRUE)
resns

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gns<-ggplot(data=resns, aes(x=phenotype, y=ns, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=ns-sd, ymax=ns+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Seed number")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gns
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# datans <- data19F[!is.na(data19F$ns),]
# 
# 
# library(glmmTMB)
# mns<- glmmTMB((ns) ~ 1 + (1|site/phenotype), data19F, family="compois")
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# summary(mns)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

# FRUpns<-(summary(mns)$sigma)^2
# phenotypepns<-0.01333
# sitepns<-1.199e-10
# 
# ICCfns<-FRUpns/(FRUpns+phenotypepns+sitepns)
# ICCans<-(phenotypepns)/(FRUpns+phenotypepns+sitepns)
# ICCrns<-sitepns/(FRUpns+phenotypepns+sitepns)
# ICCns<-ICCans-ICCrns
#   
# ICCfns*100
# ICCans*100
# ICCrns*100
# ICCns

```

# pss 2019

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(Rmisc)
respss <- summarySE(data19F, measurevar="pss", groupvars=c("site","phenotype"))
respss

library(ggplot2)
colores<-c("coral1","burlywood2","palegreen4")
gpss<-ggplot(data=respss, aes(x=phenotype, y=pss, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=pss-sd, ymax=pss+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~site)+
  labs(x="", y="Dry seed weight [g]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gpss
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

datapss <- data19F[!is.na(data19F$pss),]

library(lme4)
library(lmerTest)

mpss<- lmer(sqrt(pss) ~ 1 + (1|site/phenotype), datapss)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# 
# pss_ajuste <- as.data.frame(cbind(
#   "residuos" = residuals(mpss),
#   "predichos" = predict(mpss)))
# 
# pss_ajuste$pss <- datapss$pss
# 
# library(ggplot2)
# HVpss<-ggplot(pss_ajuste) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white")+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HVpss
# 
# QQpss<-ggplot(pss_ajuste) +
#   aes(sample = residuos) +
#   geom_qq(shape = 1, colour="white") +
#   geom_qq_line(colour="white")+
#   theme_classic()+
#   labs(y="Sample Quantiles", x="Theoretical Quantiles")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# QQpss
# 
# e<-resid(mpss) # residuos de pearson
# # pre<-predict(mpss) #predichos
# # alfai<-ranef(mpss)$REP$'(Intercept)'
# shapiro.test(e)

# OK

```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
summary(mpss)
```

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#Calculo manual ICC

# FRUppss<-(summary(mpss)$sigma)^2
# phenotypeppss<-as.numeric(VarCorr(mpss)$"phenotype:site")
# siteppss<-as.numeric(VarCorr(mpss)$"site")
# 
# ICCfpss<-FRUppss/(FRUppss+phenotypeppss+siteppss)
# ICCapss<-(phenotypeppss)/(FRUppss+phenotypeppss+siteppss)
# ICCrpss<-siteppss/(FRUppss+phenotypeppss+siteppss)
# ICCpss<-performance::icc(mpss)
#   
# ICCfpss*100
# ICCapss*100
# ICCrpss*100
# ICCpss

```

# Comapración descriptiva entre años

# Referencias

* **pff** Peso fresco del fruto
* **de** Diámetro ecuatorial
* **dp** Diámetro polar
* **PEN** Resistencia a la penetración
* **psf** Peso seco del fruto
* **pss** Peso seco semilla
* **IM** Índice de madurez

# **pff** Peso fresco del fruto
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# #setwd("C:/Users/um/Documents/ipovilonis/Doc/6 - Producción/web/ipovilonis.github.io")

datamorf<-read_excel("database.xlsx", sheet="datamorf")

datamorf$year<-as.factor(datamorf$year)
datamorf$site<-factor(datamorf$site,levels=c("concordia", "palmar", "gualeguaychu"))
datamorf$phenotype<-as.factor(datamorf$phenotype)


```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#setwd("C:/Users/um/Documents/ipovilonis/Doc/6 - Producción/web/ipovilonis.github.io")

library(Rmisc)
estpff <- summarySE(datamorf, measurevar="pff", groupvars=c("year","site"))
estpff

library(ggplot2)
gw<-ggplot(estpff, aes(x=site,y=pff,fill=year))+
  geom_bar(stat="identity", position="dodge", size=2, width = 0.5)+
  geom_errorbar(aes(ymin=pff-se, ymax=pff+se),
                width=.2, position=position_dodge(0.5)) +
  theme_classic()+
  labs(y="Fresh Fruit Weigth (g)", x="")+
  # scale_color_manual(values = c("cyan2","burlywood2","palegreen4"))+
  scale_fill_manual(values = c("coral","green4","blue"))+
  theme(text = element_text(size=20))+
  theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  theme(panel.grid.major.y = element_line(size=0.02, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  geom_hline(yintercept=10.12697, linetype="dashed", 
                color = "red3", size=0.5)
gw
  

```
The bars indicate standard deviation.
The dashed red line indicates the mean.

# **de** Diámetro ecuatorial

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
#setwd("C:/Users/um/Documents/ipovilonis/Doc/6 - Producción/web/ipovilonis.github.io")

library(Rmisc)
estde <- summarySE(datamorf, measurevar="de", groupvars=c("year","site"))
estde

library(ggplot2)
gde<-ggplot(estde, aes(x=site,y=de,fill=year))+
  geom_bar(stat="identity", position="dodge", size=2, width = 0.5)+
  geom_errorbar(aes(ymin=de-se, ymax=de+se),
                width=.2, position=position_dodge(0.5)) +
  theme_classic()+
  labs(y="Ecuatorial diameter (mm)", x="")+
  # scale_color_manual(values = c("cyan2","burlywood2","palegreen4"))+
  scale_fill_manual(values = c("coral","green4","blue"))+
  theme(text = element_text(size=20))+
  theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  theme(panel.grid.major.y = element_line(size=0.02, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))+
  geom_hline(yintercept=27.56145, linetype="dashed", 
                color = "red3", size=0.5)
gde
  
```

The bars indicate standard deviation.
The dashed red line indicates the mean.
