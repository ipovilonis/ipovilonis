---
output: pdf_document
---

# Peso seco

## Carga de datos y conversión de variables
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


# Cargar de base de datos

library(readxl)
datospeso <- read_excel("database.xlsx", sheet="fisico")

# Se asigna correctamente la clase de cada variable

datospeso$year<-factor(datospeso$year,levels=c("2019","2021","2022"))
datospeso$site<-factor(datospeso$site,levels=c("concordia", "palmar","gualeguaychu"))
datospeso$mad<-factor(datospeso$mad,levels=c("I", "MM","M","SM"))
datospeso$phenotype<-as.factor(datospeso$phenotype)
datospeso$n <-as.factor(datospeso$n)
datospeso$pff <- as.numeric(datospeso$pff)
datospeso$pss <- as.numeric(datospeso$pss)

```


```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos de peso seco (en este caso no hay)
library(dplyr)
datospeso_sna <- datospeso %>% filter(!is.na(psf))

```

## Gráfico de dispersión
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gg_pesoseco_3a <- ggplot(data=datospeso_sna, aes(x=psf, y=pff, color=mad))+
  geom_point(size=5)+
  # facet_grid(.~year)+
  labs(x="Peso seco fruto (g)", y="Peso fresco fruto (g)")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_color_manual(values = c("blue","green3","gold","orange4")) +
  # scale_color_manual(values = c("coral1","burlywood2","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gg_pesoseco_3a

```

## Se ajusta el modelo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_ps <- lm(psf ~ pff, data=datospeso)

```


```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

## Predicciones del modelo

# Crear un nuevo data frame con los valores para pff
nuevos_datos <- data.frame(
  pff = datospeso$pff  # Valores de pff
)

# Hacer predicciones
predicciones1 <- predict(modelo_ps, newdata = nuevos_datos)

# Ver las predicciones
# print(predicciones1)

modelo_ps

```

## Modelo
```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

summary(modelo_ps)

```

# Análisis univariado

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
database <- read_excel("database.xlsx", sheet = "2022_quimico")
# View(database)

database$phenotype <- as.factor(database$phenotype)
database$site<-factor(database$site,levels=c("Concordia", "Gualeguaychu"))
database$maturity<-factor(database$maturity, levels=c("I", "MM","M","SM"))
database$phenotype<-as.factor(database$phenotype)
# database$id <-as.factor(database$id)

# database$pss <- as.numeric(database$pss)

```


## Fenoles

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_phenols <- database %>% filter(!is.na(phenols_ps))

```

### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_phenols_ps <- database_phenols %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(phenols_ps),
    min = min(phenols_ps),
    max = max(phenols_ps),
    sd = sd(phenols_ps),
    )

table_phenols_ps
```

### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_phen_site <- ggplot(data=table_phenols_ps, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Fenoles [eq Ac. Tan/100g PS]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_phen_site
```

### Tabla descriptiva por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_phenols_ps_phenotype <- database_phenols %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(phenols_ps),
    min = min(phenols_ps),
    max = max(phenols_ps),
    sd = sd(phenols_ps),
    )

table_phenols_ps_phenotype
```

### Gráficos por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gphenols<-ggplot(data=table_phenols_ps_phenotype, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Fenoles [eq Ac. Tan/100g PS]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gphenols

gphenols2<-ggplot(data=database_phenols, aes(x=phenotype, y=Fenoles, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="Fenoles [eq Ac. Tan/100g PS]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gphenols2

```

## AAO
### 0.025

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_aao_0.025 <- database %>% filter(!is.na(aao_0.025))

```

####Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.025 <- database_aao_0.025 %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.025),
    min = min(aao_0.025),
    max = max(aao_0.025),
    sd = sd(aao_0.025),
    )

table_aao_0.025
```

#### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_aao_0.025_site <- ggplot(data=table_aao_0.025, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="% Inh aao_0.025")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_aao_0.025_site
```

#### Tabla descriptiva por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.025_phenotype <- database_aao_0.025 %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.025),
    min = min(aao_0.025),
    max = max(aao_0.025),
    sd = sd(aao_0.025),
    )

table_aao_0.025_phenotype
```

#### Gráficos por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gphenols<-ggplot(data=table_phenols_ps_phenotype, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="% Inh aao_0.025")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gphenols

gphenols2<-ggplot(data=database_aao_0.025, aes(x=phenotype, y=aao_0.025, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="% inh aao_0.025")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gphenols2

```

### 0.050


```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_aao_0.05 <- database %>% filter(!is.na(aao_0.05))

```

#### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.05 <- database_aao_0.05 %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.05),
    min = min(aao_0.05),
    max = max(aao_0.05),
    sd = sd(aao_0.05),
    )

table_aao_0.05
```

#### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

grafico_aao_0.05_site <- ggplot(data=table_aao_0.05, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="% Inh aao_0.05")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
grafico_aao_0.05_site
```

#### Tabla descriptiva por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.05_phenotype <- database_aao_0.05 %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.05),
    min = min(aao_0.05),
    max = max(aao_0.05),
    sd = sd(aao_0.05),
    )

table_aao_0.05_phenotype
```

#### Gráficos por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

grafico_aao_0.05_phenotype<-ggplot(data=table_aao_0.05_phenotype, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="%inh aao_0.05")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.05_phenotype

grafico_aao_0.05_phenotype_2<-ggplot(data=database_aao_0.05, aes(x=phenotype, y=aao_0.05, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="% inh aao_0.05")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.05_phenotype_2
```

### 0.100

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_aao_0.1 <- database %>% filter(!is.na(aao_0.1))

```

#### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.1 <- database_aao_0.1 %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.1),
    min = min(aao_0.1),
    max = max(aao_0.1),
    sd = sd(aao_0.1),
    )

table_aao_0.1
```

#### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

grafico_aao_0.1_site <- ggplot(data=table_aao_0.1, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="% Inh aao_0.1")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
grafico_aao_0.1_site
```

#### Tabla descriptiva por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.1_phenotype <- database_aao_0.1 %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.1),
    min = min(aao_0.1),
    max = max(aao_0.1),
    sd = sd(aao_0.1),
    )

table_aao_0.1_phenotype
```

#### Gráficos por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

grafico_aao_0.1_phenotype<-ggplot(data=table_aao_0.1_phenotype, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="%inh aao_0.1")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.1_phenotype

grafico_aao_0.1_phenotype_2<-ggplot(data=database_aao_0.1, aes(x=phenotype, y=aao_0.1, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="% inh aao_0.1")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.1_phenotype_2
```

### 0.250

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_aao_0.25 <- database %>% filter(!is.na(aao_0.25))

```

####Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.25 <- database_aao_0.25 %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.25),
    min = min(aao_0.25),
    max = max(aao_0.25),
    sd = sd(aao_0.25),
    )

table_aao_0.25
```

#### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_phen_site <- ggplot(data=table_aao_0.25, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="% Inh aao_0.25")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_phen_site
```

#### Tabla descriptiva por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_aao_0.25_phenotype <- database_aao_0.25 %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(aao_0.25),
    min = min(aao_0.25),
    max = max(aao_0.25),
    sd = sd(aao_0.25),
    )

table_aao_0.25_phenotype
```

#### Gráficos por fenotipo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

grafico_aao_0.25_phenotype<-ggplot(data=table_aao_0.25_phenotype, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="%inh aao_0.25")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.25_phenotype

grafico_aao_0.25_phenotype_2<-ggplot(data=database_aao_0.25, aes(x=phenotype, y=aao_0.1, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="% inh aao_0.25")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
grafico_aao_0.25_phenotype_2
```

## Clorofila a

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_Clo_a_ps <- database %>% filter(!is.na(Clo_a_ps))

```

### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_Clo_a_ps <- database_Clo_a_ps %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Clo_a_ps),
    min = min(Clo_a_ps),
    max = max(Clo_a_ps),
    sd = sd(Clo_a_ps),
    )

table_Clo_a_ps
```

### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_Clo_a_ps <- ggplot(data=table_Clo_a_ps, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 0.5, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Clo_a_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_Clo_a_ps
```

### Tabla resumen por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_Clo_a_ps<- database_Clo_a_ps %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Clo_a_ps),
    min = min(Clo_a_ps),
    max = max(Clo_a_ps),
    sd = sd(Clo_a_ps),
    )

table_Clo_a_ps
```

### Gráfico resumen por fenotipo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gráfico_clo_a_ps<-ggplot(data=table_Clo_a_ps, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Clo_a_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gráfico_clo_a_ps

gráfico_clo_a_ps<-ggplot(data=database_Clo_a_ps, aes(x=phenotype, y=aao_0.1, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="Clo_a_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gráfico_clo_a_ps
```

## Clorofila b

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_Clo_b_ps <- database %>% filter(!is.na(Clo_b_ps))

```

### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_Clo_b_ps <- database_Clo_b_ps %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Clo_b_ps),
    min = min(Clo_b_ps),
    max = max(Clo_b_ps),
    sd = sd(Clo_b_ps),
    )

table_Clo_b_ps
```

### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_clob_site <- ggplot(data=table_Clo_b_ps, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 0.5, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Clo_b_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_clob_site
```

### Tabla resumen por fenotipo

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_Clo_b_ps<- database_Clo_b_ps %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Clo_b_ps),
    min = min(Clo_b_ps),
    max = max(Clo_b_ps),
    sd = sd(Clo_b_ps),
    )

table_Clo_b_ps
```

### Gráfico resumen por fenotipo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gráfico_clo_b_ps<-ggplot(data=table_Clo_b_ps, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Clo_b_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gráfico_clo_b_ps

gráfico_clo_b_ps<-ggplot(data=database_Clo_b_ps, aes(x=phenotype, y=aao_0.1, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="Clo_b_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gráfico_clo_b_ps
```

## Carotenoides

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_Caro_ps <- database %>% filter(!is.na(Caro_ps))

```

### Tabla descriptiva por población

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_Caro_ps <- database_Caro_ps %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Caro_ps),
    min = min(Caro_ps),
    max = max(Caro_ps),
    sd = sd(Caro_ps),
    )

table_Caro_ps
```

### Gráfico por población

```{r  , echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
colores<-c("coral1","palegreen4")

gráfico_clob_site <- ggplot(data=table_Caro_ps, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 0.5, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Caro_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_fill_manual(values=c(colores))
gráfico_clob_site
```

### Tabla de carotenoides
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_carotenoides <- database_Caro_ps %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(Caro_ps),
    min = min(Caro_ps),
    max = max(Caro_ps),
    sd = sd(Caro_ps),
    )

table_carotenoides
```

### Gráfico de carotenoides
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gCAROTENOIDES<-ggplot(data=table_carotenoides, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="Caro_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gCAROTENOIDES

gCAROTENOIDES2<-ggplot(data=database_Caro_ps, aes(x=phenotype, y=Caro_ps, fill=phenotype))+
  geom_point()+
  geom_boxplot()+
  # facet_grid(.~year)+
  labs(x="", y="Caro_ps")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
 theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gCAROTENOIDES2

```

## Acidez Total Titulable (ATT)

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_acidity <- database %>% filter(!is.na(acidity))

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_acidity <- database_acidity %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(acidity),
    min = min(acidity),
    max = max(acidity),
    sd = sd(acidity),
    )

table_acidity

```

### Gráfico por población
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gAacidity<-ggplot(data=table_acidity, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="°Brix")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gAacidity

```

### Tabla descriptiva 

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_acidity2 <- database_acidity %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(acidity),
    min = min(acidity),
    max = max(acidity),
    sd = sd(acidity),
    )

table_acidity2
```

### Gráfico por fenotipo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gATT<-ggplot(data=table_acidity2, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="ATT (%)")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gATT

```

## Sólidos solubles

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Se quitan filas sin datos
library(dplyr)
database_ss_brix <- database %>% filter(!is.na(ss_brix))

```

### Tabla descriptiva
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_brix <- database_ss_brix %>% 
  dplyr::group_by(site) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(ss_brix),
    min = min(ss_brix),
    max = max(ss_brix),
    sd = sd(ss_brix),
    )

table_brix

```

### Gráfico por población
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gATT_brix<-ggplot(data=table_brix, aes(x=site, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="°Brix")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='none')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gATT_brix

```

### Tabla descriptiva 

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)

table_ss_brix <- database_ss_brix %>% 
  dplyr::group_by(site, phenotype) %>%
  dplyr::summarise(
    n = n(),
    Mean = mean(ss_brix),
    min = min(ss_brix),
    max = max(ss_brix),
    sd = sd(ss_brix),
    )

table_ss_brix
```

### Gráfico por fenotipo
```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gss_brix<-ggplot(data=table_ss_brix, aes(x=phenotype, y=Mean, fill=site))+
  stat_summary(fun = "mean", size = 1, geom = "bar") +
  geom_errorbar(aes(ymin=Mean-sd, ymax=Mean+sd),
                width=.2, position=position_dodge(.9))+
  # facet_grid(.~year)+
  labs(x="", y="ss_brix")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_fill_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gss_brix

```

## Relación ATT y SS

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gATT_brix_dispersion<-ggplot(data=database_ss_brix,aes(x=acidity, y=ss_brix, color=site))+
  geom_point(size=5)+
  # facet_grid(.~year)+
  labs(x="ATT (%)", y="°Brix")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_color_manual(values = c("coral1","palegreen4")) +
  # scale_color_manual(values = c("coral1","burlywood2","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))
gATT_brix_dispersion

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gATT_phi_dispersion<-ggplot(data= database_ss_brix, aes(x=pHi, y=ss_brix, color=site, shape=maturity))+
  geom_point(size=5)+
  # facet_grid(.~year)+
  labs(x="pHi", y="Brix")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_color_manual(values = c("coral1","palegreen4")) +
  # scale_color_manual(values = c("coral1","burlywood2","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=20, color='black'))+
  theme(axis.text = element_text(color='black'))
gATT_phi_dispersion

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)

gATT_phi_dispersion<-ggplot(data=database_ss_brix, aes(x=pH81, y=acidity, color=site, shape=maturity))+
  geom_point(size=5)+
  # facet_grid(.~year)+
  labs(x="pH 8.1", y="ATT (%)")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  # scale_fill_manual(values = c("coral1","burlywood2","palegreen4")) +
  scale_color_manual(values = c("coral1","palegreen4")) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=10, color='black'))+
  theme(axis.text = element_text(color='black'))
gATT_phi_dispersion
```

## Análisis de CCI

```{r echo=FALSE, warning=FALSE}

# library(lme4)
# library(lmerTest) #Test de Wald
# modelo_fenoles1 <- lmer(Fenoles ~ (1|site/phenotype), database)
# 
# modelo_fenoles2 <- glmer(Fenoles ~ (1|site/phenotype), data = database, family = "gaussian")
# 
# modelo_fenoles3 <- glmer(Fenoles ~ (1|site/phenotype), data = database, family = Gamma(link = "identity"))
# 
# modelo_fenoles4 <- glmer(Fenoles ~ (1|site/phenotype), data = database, family = Gamma(link = "log"))

```

### Resumen del modelo
```{r echo=FALSE, warning=FALSE}

# summary(modelo_fenoles1)

```

### Supuestos del modelo
```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=15, fig.height=12}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# e<-resid(modelo_fenoles) # residuos de pearson
# pre<-predict(modelo_fenoles) #predichos
# alfai<-ranef(modelo_fenoles)$phenotype$'(Intercept)'
# par(mfrow = c(1, 3))
# plot(pre, e, xlab="Predichos", ylab="Residuos de pearson",main="Gr?fico de dispersi?n de RE vs PRED",cex.main=.8 )
# abline(0,0)
# qqnorm(e, cex.main=.8)
# qqline(e)
# qqnorm(alfai, cex.main=.8)
# qqline(alfai)
# par(mfrow = c(1, 1))
```

Test de normalidad para muestras biológicas (frutos)
```{r echo=FALSE, warning=FALSE}
# shapiro.test(e)
```
Test de normalidad para genotipos
```{r echo=FALSE, warning=FALSE}
# shapiro.test(alfai)
```

```{r echo=FALSE, warning=FALSE}
# ### Significacion parte fija
# library(lme4)
# mF0<- lmer(log(fen) ~ 1 + (1|site/phenotype), datavq)
# round(anova(mF0,mfen),2)
```

```{r echo=FALSE, warning=FALSE}
# Significancia parte aleatoria
# confint(mfen, level = 0.95, method = c("profile"))
```

### Conclusiones

```{r echo=FALSE, warning=FALSE}
# report::report(modelo_fenoles4)
```

<!-- El test de Wald (p=) arroja que no hay diferencias estadísticas significativas entre años. -->

### ICC del modelo
```{r echo=FALSE, warning=FALSE}
# library(sjstats)
# performance::icc(modelo_fenoles1)
# performance::icc(modelo_fenoles2)
# performance::icc(modelo_fenoles3)
# performance::icc(modelo_fenoles4)
```

```{r echo=FALSE, warning=FALSE}
#Calculo manual ICC

# phenotypep<-0.13862
# sitep<-0.01395 
# FRUp<-0.15411
# 
# ICCf<-FRUp/(FRUp+phenotypep+sitep)
# ICCa<-phenotypep/(FRUp+phenotypep+sitep)
# ICCr<-sitep/(FRUp+phenotypep+sitep)
# 
# ICCf #0.6422508 ----> 50,3% entre muestras de una misma phenotypeesión.
# ICCa #0.2988115 ----> 45,2% entre phenotypeesiones de una misma siteión.
# ICCr #0.05893767 ----> 4,5% entre siteiones.
# 
# #ICC modelo
# # ICCr+ICCa #49.8%


```

* ----> % 
* ----> % 
* ----> % 

ICC del modelo = 

# Análisis multivariado